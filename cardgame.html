<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2505781446931756"
     crossorigin="anonymous"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XHM6DHWSRX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XHM6DHWSRX');
</script>
<title>漢字チャレンジパズル</title>
<style>
  body {
     font-family: sans-serif;
     text-align: center;
    background-color: #fff9d6;
 }
  .board {
    display: grid;
    grid-template-columns: repeat(4, 60px);
    grid-template-rows: repeat(4, 60px);
    gap: 5px;
    justify-content: center;
    margin: 20px;
  }
  .cell {
    width: 60px;
    height: 60px;
    background: #f8f8f8;
    border: 1px solid #ccc;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5em;
  }
  .hand-card {
    display: inline-block;
    width: 60px;
    height: 60px;
    margin: 5px;
    line-height: 60px;
    background: #fff;
    border: 2px solid #333;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
  }
  .highlight { background: #ffeaa7; border-color: #e17055; }
  #wordInfo {
    margin-top: 20px;
    text-align: center;
    min-height: 60px;
    border: none;
    padding: 10px;
    width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  .wordEntry { margin-bottom: 15px; }
  .wordEntry .word { text-align: center; font-size: 1.2em; font-weight: bold; }
  .wordEntry .meaning { text-align: left; margin-top: 5px; }
  .gameClear { font-weight: bold; font-size: 1.5em; margin-top: 10px; text-align: center; }
  #timer { font-weight: bold; font-size: 1.2em; margin-top: 10px; text-align: center; }
  button {
    padding: 10px 20px;
    font-size: 1em;
    cursor: pointer;
  }
  /* スマホ用調整 */
@media (max-width: 600px) {
.board {
grid-template-columns: repeat(4, 50px);
grid-template-rows: repeat(4, 50px);
gap: 4px;
}
.cell {
width: 50px;
height: 50px;
font-size: 1.2em;
}
.hand-card {
width: 50px;
height: 50px;
line-height: 50px;
font-size: 1.1em;
}
.wordEntry .word {
font-size: 1.3em;
text-align: center;
}
.wordEntry .meaning {
font-size: 1em;
margin-top: 8px;
text-align: center;
}
}
@media screen and (max-width: 600px) {
  #wordInfo {
    width: 90%;         /* 画面幅に合わせる */
    font-size: 0.9em;   /* 少し文字サイズを小さく */
  }
  .wordEntry .word {
    font-size: 1.1em;   /* 単語部分は強調 */
  }
  .wordEntry .meaning {
    font-size: 0.9em;   /* 意味は少し小さめ */
  }
}

</style>
</head>
<body>
<h1>漢字チャレンジパズル</h1>
<div id="timer">経過時間: 0 秒</div>
<div class="board" id="board"></div>
<div class="zone" id="wordInfo"></div>
<div class="zone">
  <div id="hand"></div>
</div>
<div class="zone">
  <button id="saveScoreBtn" style="display:none;" onclick="saveScore()">クリアタイムを記録</button><br>
  <br>
  <button onclick="startGame()">最初から始める</button>
</div>
<footer>
  <p>©啓次郎 | <a href="https://forms.gle/LbM6LAJCj1NV7XqH8" target="_blank">誤字誤答報告</a> | <a href="https://hamuburo.hatenablog.com/" target="_blank">とあるおっさんの戯言</a></p>
  <p><a href="index.html">トップページ</a> | <a href="privacy.html">プライバシーポリシー</a></p>
</footer>

<script>
const dictionary = [
  {word:"火花", reading:"ひばな", meaning:"細かく飛び散る火の粉。"},
  {word:"火山", reading:"かざん", meaning:"地下のマグマやその生成物が地表に噴出して生じた地形。"},
  {word:"火水", reading:"ひみず", meaning:"火と水。仲が非常に悪いこと。"},
  {word:"火石", reading:"かせき", meaning:"火で焼いて熱くなった石。\n　ーー精選版 日本国語大辞典より"},
  {word:"火中", reading:"かちゅう", meaning:"燃えている火の中。「ーーの栗を拾う」。"},
  
  {word:"花火", reading:"はなび", meaning:"黒色火薬・発色剤などをまぜ合わせて筒や玉などに詰め、点火して破裂・燃焼させ、その色彩の美しさや爆音などを楽しむもの。夏の風物詩。"},
  {word:"花山", reading:"はなやま", meaning:"桜の花の咲いている山。\n　ーー精選版 日本国語大辞典より"},
  {word:"花木", reading:"かぼく", meaning:"花と木。"},
  {word:"花雨", reading:"かう", meaning:"主に桜の花びらが雨のように散りゆく様子。\n　ーー精選版 日本国語大辞典より"},
  {word:"花水", reading:"はなみず", meaning:"仏前に花を供える時に用いる水。仏教用語。"},
  {word:"花草", reading:"はなくさ", meaning:"花の咲いている草。\n　ーー精選版 日本国語大辞典より"},
  {word:"花音", reading:"かいん", meaning:"花が咲いたという知らせ。花信ともいう。\n　ーー普及版 字通より"},
  {word:"花村", reading:"かそん", meaning:"花の咲く村。\n　ーー普及版 字通より"},
  
  {word:"山火", reading:"さんか", meaning:"山に起こる火災。山火事。"},
  {word:"山花", reading:"さんか", meaning:"山中に咲く花。\n　ーー精選版 日本国語大辞典より"},
  {word:"山木", reading:"やまぎ", meaning:"山に生えている木。\n　ーー精選版 日本国語大辞典より"},
  {word:"山雨", reading:"さんう", meaning:"山に降る雨。また、山の方から降り始めた雨。\n　ーー精選版 日本国語大辞典より"},
  {word:"山水", reading:"さんすい", meaning:"山と水。山と川。山と水のある風景。また、山から流れ出る水。"},
  {word:"山草", reading:"やまくさ", meaning:"山に生えている草。"},
  {word:"山石", reading:"やまいし/さんせき", meaning:"山から出る石。山にある石。山の石。\n　ーー精選版 日本国語大辞典より"},
  {word:"山中", reading:"さんちゅう", meaning:"山の中。山間。"},
  {word:"山村", reading:"さんそん", meaning:"山の中にある村。"},
  
  {word:"木花", reading:"きばな", meaning:"樹氷。霧滴が樹の枝などについて氷結したもの。冬の季語。"},
  {word:"木山", reading:"きやま", meaning:"材木を切り出す山のこと。\n　ーー精選版 日本国語大辞典より"},
  {word:"木水", reading:"きみず", meaning:"水の乏しい場所で樹木の根元に木の葉などをつけ、枝葉から伝わる雨水を容器に集める装置。\n　ーー精選版 日本国語大辞典より"},
  {word:"木草", reading:"きくさ", meaning:"木と草。草木。\n　ーー精選版 日本国語大辞典より"},
  {word:"木石", reading:"ぼくせき", meaning:"木と石。樹木と岩石。転じて、人間らしい感情のないもののたとえ。"},
  
  {word:"雨花", reading:"うか", meaning:"雨が降る中の花。\n　ーー普及版 字通より"},
  {word:"雨水", reading:"うすい", meaning:"降る雨の水。また、雨が降って溜まった水。"},
  {word:"雨空", reading:"あまぞら", meaning:"今にも雨が降り出しそうな空。また、雨の降っている空。"},
  {word:"雨音", reading:"あまおと", meaning:"降る雨が物に触れて奏でる音"},
  {word:"雨中", reading:"うちゅう", meaning:"雨が降っている中。"},
  
  {word:"水火", reading:"すいか", meaning:"水と火。洪水と火事。また、互いに相容れないこと。"},
  {word:"水木", reading:"みずき", meaning:"ミズキ科の落葉高木。山地に自生している。"},
  {word:"水空", reading:"すいくう", meaning:"広い雪原や氷海において、水面に上空の雲の底面だけ光の反射がなくやや黒っぽく見える現象。氷海を航海する場合の重要な目標。"},
  {word:"水草", reading:"みずくさ", meaning:"水中、または水辺に生える草。"},
  {word:"水石", reading:"すいせき", meaning:"水と石。泉水と庭石。また、水中にある石。\n　ーー精選版 日本国語大辞典より"},
  {word:"水音", reading:"みすおと", meaning:"水の流れる音。水滴の落ちる音。"},
  {word:"水中", reading:"すいちゅう", meaning:"水の中。"},
  {word:"水村", reading:"すいそん", meaning:"水辺の村。湖や川の景色が美しい村。"},
  
  {word:"空花", reading:"くうげ", meaning:"本来存在しないものがまるでそこにあるかのように見えて囚われていること。仏教用語。\n　ーー精選版 日本国語大辞典より"},
  {word:"空山", reading:"くうざん", meaning:"人の気配のない寂しい山。"},
  {word:"空木", reading:"うつぎ", meaning:"アジサイ科の幹の内部が中空の落葉低木。山野に自生。“うつろぎ”と読む場合は中が腐って空洞になった木のこと。"},
  {word:"空水", reading:"くうすい", meaning:"空と水。\n　ーー普及版 字通より"},
  {word:"空草", reading:"うつぼぐさ", meaning:"ユリ科の多年草。ネギのこと。\n　ーー精選版 日本国語大辞典より"},
  {word:"空音", reading:"そらね", meaning:"実際には鳴っていないのに聞こえているような気がする楽器の音。また、鳴らそうとしていないのに、たまたま触れて鳴ってしまう楽器の音。"},
  {word:"空中", reading:"くうちゅう", meaning:"地面や水面から離れた場所。物体が何にも触れていない状態。"},
  {word:"空村", reading:"くうそん", meaning:"無人の村。\n　ーー普及版 字通より"},
  
  {word:"草火", reading:"くさび", meaning:"草を焼く火。\n　ーー精選版 日本国語大辞典より"},
  {word:"草花", reading:"くさばな", meaning:"草と花。花の咲く草。また、草に咲く花。秋の季語。"},
  {word:"草山", reading:"くさやま", meaning:"草の生い茂った山。\n　ーー精選版 日本国語大辞典より"},
  {word:"草木", reading:"くさき", meaning:"草と木。"},
  {word:"草中", reading:"そうちゅう", meaning:"草の中。草むらの中。\n　ーー精選版 日本国語大辞典より"},
  
  {word:"石火", reading:"せっか", meaning:"火打石を使って出す火。また、石や金属が激しくぶつかり合って起こる火。"},
  {word:"石花", reading:"せきか", meaning:"貝類。特に牡蠣のこと。また、軽石のこと。\n　ーー精選版 日本国語大辞典より"},
  {word:"石山", reading:"いしやま", meaning:"岩石の多い山。また、石材を切り出す山。"},
  {word:"石木", reading:"いわき", meaning:"岩石と樹木。また、感情を持たないもののたとえ。岩木と書く方が一般的。"},
  {word:"石草", reading:"いしくさ/いしぐさ", meaning:"キク科の一年草。センダングサの別名。\n　ーー動植物名よみかた辞典 普及版より"},
  {word:"石音", reading:"いしおと", meaning:"碁を打つ音。石の触れ合う音。\n　ーー精選版 日本国語大辞典より"},

  {word:"音木", reading:"おんぎ", meaning:"仏具の一つ。拍子木に似ている。読経のとき、句読に合わせて打ち鳴らし、音頭を取るのに使う。\n　ーー精選版 日本国語大辞典より"},

  {word:"中火", reading:"ちゅうび", meaning:"中くらいの火力。強火と弱火との間の、中程度の火加減。"},
  {word:"中山", reading:"ちゅうざん", meaning:"琉球王国の異称。中国側からの呼称。小国家の中山が北山、南山を滅ぼして統一王朝を樹立したことからそう呼ばれた。"},
  {word:"中水", reading:"ちゅうすい", meaning:"雨水や雑排水を浄化した水。飲用にはできないが、工業用水や水洗トイレ、散水などの雑用に利用される。"},
  {word:"中空", reading:"ちゅうくう", meaning:"空の真ん中。また、物の内部がからになっている状態。"},
  {word:"中石", reading:"なかいし", meaning:"断層面に挟在する岩石塊のこと。通常、断層ができるとき断層面に沿う岩石は粉砕されるが、その際に比較的大きく塊状に切取られた岩石の一部が，上盤と下盤の間にはさまれて中石となることがある。\n　ーーブリタニカ国際大百科事典 小項目事典より"},
  {word:"中音", reading:"ちゅうおん", meaning:"中くらいの高さや強さの音または声。また、音楽で中程度の音域の音。アルト。"},

  {word:"村山", reading:"むらやま", meaning:"江戸時代に一村として共有し、共同用益した山。\n　ーー精選版 日本国語大辞典より"},
  {word:"村雨", reading:"むらさめ", meaning:"激しく降ってすぐに止む雨。夕立のような雨。"},
  {word:"村中", reading:"そんちゅう", meaning:"村中の人。\n　ーー普及版 字通より"}
];


const boardSize = 4;
let kanjiList = "火花山木雨水空草石音中村".split("");
let deck = [];
let hand = [];
let board = Array(boardSize).fill(null).map(()=>Array(boardSize).fill(null));
let selectedHandIndex = null;
let displayedWord = null;
let startTime;              // ゲーム開始時の時刻を保存
let timerInterval;          // setInterval の ID を保存（止めるときに使う）
let finalElapsedSeconds = 0; // 最終クリアタイム（秒）を保存
const initialHandCount = 7;

function shuffle(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}return array;}

// 新しいゲーム開始処理
function startGame() {
// 盤面リセット
document.getElementById('board').innerHTML = '';
document.getElementById('hand').innerHTML = '';
document.getElementById('wordInfo').innerHTML = '';


// クリアタイム記録ボタン非表示
const saveButton = document.getElementById('saveScoreBtn');
if (saveButton) saveButton.style.display = 'none';


// タイマーリセット
clearInterval(timerInterval);
document.getElementById('timer').innerText = '⏱️ 経過時間: 0秒';
finalElapsedSeconds = 0;
startTime = null;


// 盤面データリセット
board = Array(boardSize).fill(null).map(()=>Array(boardSize).fill(null));

// 選択中手札もリセット
selectedHandIndex = null;

// 表示中の単語情報もリセット
displayedWord = null;

// ゲーム初期化
init();
}

function startTimer() {
startTime = Date.now();
timerInterval = setInterval(() => {
const elapsed = Math.floor((Date.now() - startTime) / 1000);
document.getElementById('timer').innerText = `⏱️ 経過時間: ${elapsed}秒`;
}, 1000);
}

function stopTimer() {
clearInterval(timerInterval);
finalElapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
}

function init(){
  deck=shuffle([...kanjiList]);
  hand=deck.splice(0,initialHandCount);
  let placedCount=0;
  while(placedCount<3&&deck.length>0){
    let kanji=deck.pop();
    if(placeRandomNonAdjacent(kanji)){placedCount++;}
  }
  render();
  startTimer();
}

function placeRandomNonAdjacent(kanji){let tries=0;while(tries<100){let x=Math.floor(Math.random()*boardSize);let y=Math.floor(Math.random()*boardSize);if(!board[y][x]&&isNonAdjacent(x,y)){board[y][x]=kanji;return true;}tries++;}return false;}
function isNonAdjacent(x,y){const directions=[[1,0],[-1,0],[0,1],[0,-1]];for(let [dx,dy]of directions){let nx=x+dx,ny=y+dy;if(nx>=0&&nx<boardSize&&ny>=0&&ny<boardSize){if(board[ny][nx])return false;}}return true;}

function render(){
  const boardDiv=document.getElementById('board');
  boardDiv.innerHTML='';
  for(let y=0;y<boardSize;y++){
    for(let x=0;x<boardSize;x++){
      let el=document.createElement('div');
      el.className='cell';
      if(board[y][x]) el.innerText=board[y][x];
      el.onclick=()=>cellClick(x,y);
      boardDiv.appendChild(el);
    }
  }

  const handDiv=document.getElementById('hand');
  handDiv.innerHTML='';
  hand.forEach((k,i)=>{
    let el=document.createElement('div');
    el.className='hand-card';
    el.innerText=k;
    el.onclick=()=>handClick(i);
    if(i===selectedHandIndex) el.classList.add('highlight');
    handDiv.appendChild(el);
  });

  updateWordInfo();
}

function handClick(index){selectedHandIndex=index;render();}

function cellClick(x,y){
  if(selectedHandIndex===null) return;
  if(board[y][x]) return;
  let kanji=hand[selectedHandIndex];

  if(!canFormWord(x,y,kanji)){
    displayedWord={word:'', reading:'', meaning:'ここには置けません'};
    updateWordInfo();
    return;
  }

  board[y][x]=kanji;
  hand.splice(selectedHandIndex,1);
  selectedHandIndex=null;

  checkWord(x,y);
  render();
}

function canFormWord(x,y,kanji){
  let pairs=[];
  if(y>0&&board[y-1][x]) pairs.push(board[y-1][x]+kanji);
  if(y<boardSize-1&&board[y+1][x]) pairs.push(kanji+board[y+1][x]);
  if(x>0&&board[y][x-1]) pairs.push(board[y][x-1]+kanji);
  if(x<boardSize-1&&board[y][x+1]) pairs.push(kanji+board[y][x+1]);
  return pairs.some(p=>dictionary.find(entry=>entry.word===p));
}

function checkWord(x,y){
  displayedWord=null;
  let k=board[y][x];
  let pairs=[];
  if(y>0&&board[y-1][x]) pairs.push(board[y-1][x]+k);
  if(y<boardSize-1&&board[y+1][x]) pairs.push(k+board[y+1][x]);
  if(x>0&&board[y][x-1]) pairs.push(board[y][x-1]+k);
  if(x<boardSize-1&&board[y][x+1]) pairs.push(k+board[y][x+1]);
  pairs.forEach(p=>{
    let matched=dictionary.find(entry=>entry.word===p);
    if(matched){displayedWord=matched;}
  });
}

function updateWordInfo(){
  const infoDiv=document.getElementById('wordInfo');
  infoDiv.innerHTML='';

  if(displayedWord){
    let entryDiv=document.createElement('div');
    entryDiv.className='wordEntry';
    let wordDiv=document.createElement('div');
    wordDiv.className='word';
    if(displayedWord.word) wordDiv.innerHTML=`<ruby><rb>${displayedWord.word}</rb><rt>${displayedWord.reading}</rt></ruby>`;
    let meaningDiv=document.createElement('div');
    meaningDiv.className='meaning';
    meaningDiv.innerText=displayedWord.meaning;
    entryDiv.appendChild(wordDiv);
    entryDiv.appendChild(meaningDiv);
    infoDiv.appendChild(entryDiv);
  }

 if(hand.length===0){
  let clearDiv=document.createElement('div');
  clearDiv.className='gameClear';
  clearDiv.innerText='🎉 ゲームクリア！';
  infoDiv.appendChild(clearDiv);

  // タイマー停止
  stopTimer();

  // 記録ボタン表示
  document.getElementById('saveScoreBtn').style.display = 'inline-block';
}
}
  
function saveScore() {
const name = prompt('名前を入力してください（任意）') || '名無し';
const score = { name, time: finalElapsedSeconds };
let scores = JSON.parse(localStorage.getItem('ranking')) || [];
scores.push(score);
scores.sort((a, b) => a.time - b.time); // 速い順

// 上位100件だけ保持
if (scores.length > 100) scores = scores.slice(0, 100);
localStorage.setItem('ranking', JSON.stringify(scores));

// ★ 保存後、ranking.html に移動
window.location.href = 'ranking.html';
}

init();
</script>
</body>
</html>

